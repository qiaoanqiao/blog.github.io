<!DOCTYPE html>





<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    save_scroll: false,
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="标签（空格分隔）： vagrant  看本文首先你要对vagrant有一定了解 传送门 从网上搜索国内镜像源,他们说官方有cdn那就从官方搜索下载了 Vagrant 就是使用 Ruby 写成的, 所以在这里的配置文件也需要满足 Ruby 语法。 config.vm.box = “ubuntu/trusty64”可以看到，这两行就是我们在vagrant init中后面所指定的参数。由此可以看出，va">
<meta name="keywords" content="vagrant">
<meta property="og:type" content="article">
<meta property="og:title" content="vagrant使用记录">
<meta property="og:url" content="https://www.fenxiangy.com/note//vagrant-usage-record.html">
<meta property="og:site_name" content="分享哟">
<meta property="og:description" content="标签（空格分隔）： vagrant  看本文首先你要对vagrant有一定了解 传送门 从网上搜索国内镜像源,他们说官方有cdn那就从官方搜索下载了 Vagrant 就是使用 Ruby 写成的, 所以在这里的配置文件也需要满足 Ruby 语法。 config.vm.box = “ubuntu/trusty64”可以看到，这两行就是我们在vagrant init中后面所指定的参数。由此可以看出，va">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.fenxiangy.com/usr/uploads/2018/07/286915945.jpg">
<meta property="og:updated_time" content="2019-08-05T08:09:33.649Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vagrant使用记录">
<meta name="twitter:description" content="标签（空格分隔）： vagrant  看本文首先你要对vagrant有一定了解 传送门 从网上搜索国内镜像源,他们说官方有cdn那就从官方搜索下载了 Vagrant 就是使用 Ruby 写成的, 所以在这里的配置文件也需要满足 Ruby 语法。 config.vm.box = “ubuntu/trusty64”可以看到，这两行就是我们在vagrant init中后面所指定的参数。由此可以看出，va">
<meta name="twitter:image" content="https://www.fenxiangy.com/usr/uploads/2018/07/286915945.jpg">
  <link rel="canonical" href="https://www.fenxiangy.com/note//vagrant-usage-record">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>vagrant使用记录 | 分享哟</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c0261b738d8ce7c4fcea76f72faec843";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">分享哟</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">很少有人懂天秤, 以前没有. 以后也没有。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-sitemap">
      
    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

    

    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


    </div>
</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.fenxiangy.com/note/vagrant-usage-record.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Murry">
      <meta itemprop="description" content="分享哟,php程序猿,php博客,phpblog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="分享哟">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">vagrant使用记录

            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-07-10 11:30:14" itemprop="dateCreated datePublished" datetime="2018-07-10T11:30:14+08:00">2018-07-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-08-05 16:09:33" itemprop="dateModified" datetime="2019-08-05T16:09:33+08:00">2019-08-05</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/note/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
              
            </span>
          

          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    <span class="post-meta-item-text">评论数：</span>
  
    <a href="/note/vagrant-usage-record.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/note/vagrant-usage-record.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id><a href="#" class="headerlink" title></a><img src="https://www.fenxiangy.com/usr/uploads/2018/07/286915945.jpg" alt="vagrant使用记录"></h1><p>标签（空格分隔）： vagrant</p>
<hr>
<p>看本文首先你要对vagrant有一定了解 <a href="https://www.jianshu.com/p/2d4afce8fe12" target="_blank" rel="noopener">传送门</a></p>
<p>从网上搜索国内镜像源,他们说官方有cdn那就从<a href="https://app.vagrantup.com/boxes/search" target="_blank" rel="noopener">官方搜索</a>下载了</p>
<p>Vagrant 就是使用 Ruby 写成的, 所以在这里的配置文件也需要满足 Ruby 语法。</p>
<p>config.vm.box = “ubuntu/trusty64”<br>可以看到，这两行就是我们在vagrant init中后面所指定的参数。由此可以看出，vagrant init只是帮我们生成了配置文件而已，换句话说，如果我们写好了Vagrantfile，就不需要vagrant init，只需将准备好的配置文件放入到所需目录中，然后直接执行vagrant up即可。</p>
<p>还有很多注释掉的配置，那些都是一些常用的配置，包括网卡设置、IP地址、绑定目录，甚至可以指定内存大小、CPU个数、是否启动界面等等。如果需要，可以根据注释文本进行配置。</p>
<p>下面列出一些常用的配置：</p>
<pre><code>config.vm.hostname：配置虚拟机主机名

config.vm.network：这是配置虚拟机网络，由于比较复杂，我们其后单独讨论

config.vm.synced_folder：除了默认的目录绑定外，还可以手动指定绑定

config.ssh.username：默认的用户是vagrant，从官方下载的box往往使用的是这个用户名。如果是自定制的box，所使用的用户名可能会有所不同，通过这个配置设定所用的用户名。

config.vm.provision：我们可以通过这个配置在虚拟机第一次启动的时候进行一些安装配置，后面我们将专门介绍。</code></pre><p>需要注意的是，Vagrantfile文件只会在第一次执行vagrant up时调用执行，其后如果不明确使用vagrant reload，则不会被强制重新加载。</p>
<p>config.vm.network”forwarded_port”,guest:80,host:8080<br>这将让物理机的8080端口映射到虚拟机的80端口。因此，可以在物理机上直接访问虚拟机所建立的网站。这在虚拟机使用不是桥接的时候尤为重要，因为很多时候默认会禁止物理机通过网络直接访问虚拟机，通过端口映射可以依旧能够访问所需端口。</p>
<p>我们还可以通过config.vm.network来指定所在网络以及IP地址。一般来说，分为private_network还是public_network。</p>
<pre><code>private_network： 私有网络</code></pre><p>位于私有网络的主机之间可以互相访问，但是外界无法访问私有网络的主机，对于某些虚拟机而言，连物理机都无法通过网络直接访问虚拟机，此时如果需要使用物理机访问虚拟机，就需要前面所提及的端口映射。例如：</p>
<pre><code>config.vm.network&quot;private_network&quot;,ip:&quot;192.168.33.10&quot;</code></pre><p>public_network：公有网络<br>在绝大多数虚拟机上，这等同于桥接网络。如果虚拟机选择了桥接方式连接，也就是相当于虚拟机和物理机在网络上处于平等的位置，同样的接在了网卡所在的网络。因此从外界看来，会感觉这是两台独立的计算机。</p>
<p>配置方式和私有网络接近，只需将其中的private_network换成public_network。如要使用 DHCP：</p>
<pre><code>config.vm.network&quot;public_network&quot;</code></pre><p>如果物理机存在多块网卡，需要指定某一块作为桥接用，那么可以参考如下配置：</p>
<pre><code>config.vm.network&quot;public_network&quot;,:bridge=&gt;&apos;en1: Wi-Fi (AirPort)&apos;</code></pre><p>如果是在启动了虚拟机之后，需要重新加载配置，只需要执行：</p>
<pre><code>vagrant reload</code></pre><br>
<br>
<br>
<br>
<br>

<p> vagrant基本命令，根据操作的目的，可以对基本命令进行分类：<br>1 操作镜像<br>box package<br>2 操作虚拟机<br>connect destroy halt init powershell provision rdp reload resume share snapshot ssh suspend up<br>3 监控虚拟机<br>global-status ssh-config port status<br>4 其他<br>help login plugin push version</p>
<p>1 操作镜像<br>该命令有两个，用来管理本地镜像<br>1.1 vagrant box<br>1.1.1 添加镜像到本地仓库<br>$ vagrant box add [box-name] [box镜像文件或镜像名]</p>
<p>1.1.2 移除本地镜像<br>$ vagrant box remove [box-name]</p>
<p>box多版本共存的情况<br>如果box升级过，那么在box list中会出现两个同名，但版本不同的镜像。如：<br>$ vagrant box list |grep coreos<br>coreos-alpha                         (virtualbox, 745.1.0)<br>coreos-alpha                         (virtualbox, 928.0.0)</p>
<p>使用该镜像创建虚拟机的时候，默认会使用高版本的box。<br>如果想使用低版本，需要修改Vagrantfile,指定box-version<br>在config.vm.box=xxx下一行，如上面的例子中，在“config.vm.box = “coreos-alpha””后面增加一行配置信息：<br>config.vm.box_version = “745.1.0”</p>
<p>同样，如果想删除一个box，如下操作会失败：<br>$ vagrant box remove coreos-alpha<br>You requested to remove the box ‘coreos-alpha’ with provider<br>‘virtualbox’. This box has multiple versions. You must<br>explicitly specify which version you want to remove with<br>the <code>--box-version</code> flag or specify the <code>--all</code> flag to remove all<br>versions. The available versions for this box are:</p>
<ul>
<li>745.1.0</li>
<li>928.0.0</li>
</ul>
<p>这时有两个选择：</p>
<ul>
<li>vagrant box remove coreos-alpha –all<br>删除所有同名镜像</li>
<li>vagrant box remove coreos-alpha –box-version=745.1.0<br>删除指定版本的镜像</li>
</ul>
<p>1.1.3 升级镜像<br>检查镜像是否有升级？<br>$ cd ~/vm/ubuntu<br>$ vagrant box outdated<br>Checking if box ‘ubuntu/trusty64’ is up to date…<br>A newer version of the box ‘ubuntu/precise64’ is available! You currently<br>have version ‘20160122.0.0’. The latest is version ‘20160209.0.0’. Run<br><code>vagrant box update</code> to update.</p>
<p>中央仓库有新版更新了，手动更新box。更新的结果并不是替换旧版本，而是在本地仓库中增加了新版的box镜像。<br>$ cd ~/vm/ubuntu<br>$ vagrant box update<br>==&gt; default: Checking for updates to ‘ubuntu/precise64’<br>    default: Latest installed version: 20160120.0.0<br>    default: Version constraints:<br>    default: Provider: virtualbox<br>==&gt; default: Updating ‘ubuntu/precise64’ with provider ‘virtualbox’ from version<br>==&gt; default: ‘20160120.0.0’ to ‘20160201.0.0’…<br>==&gt; default: Loading metadata for box ‘<a href="https://atlas.hashicorp.com/ubuntu/precise64?access_token=cXR0wCgWXoRpMw.atlasv1.ydBAS4ev1YCWzSK4S1l6iVjssRbO5Q50a8YVnEPqoyYjcQVeaMdEsiQ8rz8tOcSHLuY&#39;" target="_blank" rel="noopener">https://atlas.hashicorp.com/ubuntu/precise64?access_token=cXR0wCgWXoRpMw.atlasv1.ydBAS4ev1YCWzSK4S1l6iVjssRbO5Q50a8YVnEPqoyYjcQVeaMdEsiQ8rz8tOcSHLuY&#39;</a><br>==&gt; default: Adding box ‘ubuntu/precise64’ (v20160201.0.0) for provider: virtualbox<br>    default: Downloading: <a href="https://atlas.hashicorp.com/ubuntu/boxes/precise64/versions/20160201.0.0/providers/virtualbox.box" target="_blank" rel="noopener">https://atlas.hashicorp.com/ubuntu/boxes/precise64/versions/20160201.0.0/providers/virtualbox.box</a><br>==&gt; default: Successfully added box ‘ubuntu/precise64’ (v20160201.0.0) for ‘virtualbox’!</p>
<p>$ vagrant box list | grep precise64<br>ubuntu/precise64                     (virtualbox, 20160120.0.0)<br>ubuntu/precise64                     (virtualbox, 20160201.0.0)</p>
<p>也可以检查本地仓库中的所有镜像是否有升级,使用 –global 开关，这时候不需要进入工作目录<br>$ vagrant box outdated –global</p>
<ul>
<li>‘ubuntu/trusty64’ is outdated! Current: 20160122.0.0. Latest: 20160209.0.0</li>
<li>‘ubuntu/precise64’ (v20160201.0.0) is up to date</li>
<li>‘pollyduan/bento_oracle_xe’ wasn’t added from a catalog, no version information</li>
<li>‘phusion/ubuntu-14.04-amd64’ (v2014.04.30) is up to date</li>
<li>‘hashicorp/precise32’ (v1.0.0) is up to date</li>
<li>‘hashicorp/boot2docker’ (v1.7.8) is up to date</li>
<li>‘debian/jessie64’ wasn’t added from a catalog, no version information</li>
<li>‘coreos-alpha’ is outdated! Current: 928.0.0. Latest: 955.0.0</li>
<li>‘centos7’ wasn’t added from a catalog, no version information</li>
<li>‘centos65’ wasn’t added from a catalog, no version information</li>
<li>‘centos64’ wasn’t added from a catalog, no version information</li>
<li>‘bento/ubuntu-14.04’ (v2.2.3) is up to date</li>
<li>‘bento/opensuse-13.2-x86_64’ (v2.2.1) is up to date</li>
<li>‘bento/freebsd-10.2’ (v2.2.3) is up to date</li>
<li>‘bento/fedora-22’ (v2.2.3) is up to date</li>
<li>‘bento/debian-8.2’ (v2.2.3) is up to date</li>
<li>‘bento/centos-7.2’ (v2.2.3) is up to date</li>
<li>‘bento/centos-6.7’ (v2.2.3) is up to date</li>
</ul>
<p>不进入工作目录进行升级<br>$ vagrant box update –box coreos-alpha<br>Checking for updates to ‘coreos-alpha’<br>Latest installed version: 928.0.0<br>Version constraints: &gt; 928.0.0<br>Provider: virtualbox<br>Updating ‘coreos-alpha’ with provider ‘virtualbox’ from version<br>‘928.0.0’ to ‘955.0.0’…<br>Loading metadata for box ‘<a href="http://alpha.release.core-os.net/amd64-usr/current/coreos_production_vagrant.json&#39;" target="_blank" rel="noopener">http://alpha.release.core-os.net/amd64-usr/current/coreos_production_vagrant.json&#39;</a><br>Adding box ‘coreos-alpha’ (v955.0.0) for provider: virtualbox<br>Downloading: <a href="http://alpha.release.core-os.net/amd64-usr/955.0.0/coreos_production_vagrant.box" target="_blank" rel="noopener">http://alpha.release.core-os.net/amd64-usr/955.0.0/coreos_production_vagrant.box</a><br>Box download is resuming from prior download progress<br>Progress: 1% (Rate: 92912/s, Estimated time remaining: 0:38:09)<br>…</p>
<p>1.2 打包镜像<br>创建vm以后，我们自己根据需要安装软件，配置环境，都一切就绪了。如何分发给小伙伴使用呢？这里就要涌到package命令了，把镜像打包分发。<br>$ ll ~/VirtualBox\ VMs/ |grep ubuntu<br>drwx——  6 pollyduan  staff  204  2  2 11:18 ubuntu_default_1453944793418_7699<br>先看一下我们的vm目录名，这里有个容易混淆的目录：</p>
<ul>
<li>Vagrantfile所在的目录——vagrant的工作目录</li>
<li>虚拟机文件所在的目录——virtualbox的工作目录<br>这两个目录名不一定相同，如果在Vagrantfile中指定了vb.name，virtualbox工作目录就取这个名字；否则，命名为：vagrant工作目录_随机字符串。<br>或者，也可以使用virtual box的管理工具来看vm的名称。</li>
</ul>
<p>$ VBoxManage list vms|grep ubuntu<br>“ubuntu_default_1453944793418_7699” {0362edc2-548b-400b-a55d-776b0a24cd8d}</p>
<p>package命令要使用的是virtual box工作目录。</p>
<p>格式：vagrant package –base [virtualbox的工作目录] –output [保存的文件名，缺省为package.box]</p>
<p>$ vagrant package –base ubuntu_default_1453944793418_7699 –output ubuntu_myproject_test.box<br>==&gt; ubuntu_default_1453944793418_7699: Clearing any previously set forwarded ports…<br>==&gt; ubuntu_default_1453944793418_7699: Exporting VM…<br>==&gt; ubuntu_default_1453944793418_7699: Compressing package to: /Users/pollyduan/vm/tmp/ubuntu_myproject_test.box</p>
<p>导出后，可以通过IM、ftp或其他方式分发给小伙伴，那么大家使用的环境就是一致的了。</p>
<p>2 操作虚拟机</p>
<p>2.1 启动vm</p>
<p>2.1.1 对于单虚拟机<br>$ vagrant up</p>
<p>2.1.2 如果同一个Vagrantfile定义了一个以上的虚拟机，则：<br>$ vagrant up [vm-name]<br>其他命令类似。如果省略vm-name，则依次启动所有vm。</p>
<p>2.2 重启<br>$ vagrant reload [vm-name]</p>
<p>2.3 关机<br>$ vagrant halt [vm-name]</p>
<p>2.4 销毁虚拟机<br>$ vagrant destroy [vm-name]</p>
<p>2.5 ssh登录虚拟机<br>$ vagrant ssh [vm-name]</p>
<p>2.6 休眠与唤醒<br>这一对冤家也无需多说，对于开发环境来说，个人觉得用处不是很大。<br>$ vagrant suspend<br>==&gt; default: Saving VM state and suspending execution…<br>$ vagrant status<br>Current machine states:</p>
<p>default                   saved (virtualbox)</p>
<p>To resume this VM, simply run <code>vagrant up</code>.<br>$ vagrant resume<br>==&gt; default: Resuming suspended VM…<br>==&gt; default: Booting VM…<br>……</p>
<p>2.7 快照<br>vagrant snapshot命令是vm的月光宝盒，如果vm中有任务没有跑完，需要关闭virtual box，就可以给vm做一个快照，保存vm当前所有的状态，在virtualbox重新启动后，再回复快照。<br>2.7.1 查看当前保存的快照<br>$ vagrant snapshot list<br>==&gt; default: No snapshots have been taken yet!</p>
<p>2.7.2 创建一个命名快照<br>$ vagrant snapshot save shot1<br>==&gt; default: Snapshotting the machine as ‘shot1’…<br>$ vagrant snapshot list<br>shot1</p>
<p>2.7.3 恢复快照<br>$ vagrant snapshot restore shot1<br>==&gt; default: Forcing shutdown of VM…<br>==&gt; default: Restoring the snapshot ‘shot1’…<br>……</p>
<p>恢复后，快照会一直存在，直到你手动删除它。</p>
<p>2.7.4 删除快照<br>$ vagrant snapshot delete shot1<br>==&gt; default: Deleting the snapshot ‘shot1’…<br>Progress: 90%<br>Progress: 100%<br>==&gt; default: Snapshot deleted!</p>
<p>这个操作会删除持久化的数据文件，稍微有点慢，耐心等待。这个内在的原理没有深入研究，有点不太理解，删除一个文件理论上应该比保存一个文件更快才对。</p>
<p>2.7.5 盗梦空间<br>push和pop，每调用一次push命令会自动创建一个命名快照，名为：push+一串随机数，如：push_1455524411_6632；每调用一次pop，会逐级恢复到最新的快照，并删除快照。看例子：<br>$ vagrant snapshot list<br>==&gt; default: No snapshots have been taken yet!<br>$ vagrant snapshot push<br>==&gt; default: Snapshotting the machine as ‘push_1455525041_2882’…<br>$ vagrant snapshot list<br>push_1455525041_2882<br>$ vagrant snapshot push<br>==&gt; default: Snapshotting the machine as ‘push_1455525049_7456’…<br>$ vagrant snapshot push<br>==&gt; default: Snapshotting the machine as ‘push_1455525058_6891’…<br>$ vagrant snapshot list<br>push_1455525041_2882<br>push_1455525049_7456<br>push_1455525058_6891<br>$ vagrant snapshot pop<br>==&gt; default: Forcing shutdown of VM…<br>==&gt; default: Restoring the snapshot ‘push_1455525058_6891’…<br>==&gt; default: Deleting the snapshot ‘push_1455525058_6891’…<br>==&gt; default: Snapshot deleted!<br>$ vagrant snapshot list<br>push_1455525041_2882<br>push_1455525049_7456</p>
<p>Tips: 文本的日志看起来还不够形象，在push三个snapshot后在virtual box中是树形显示的；每次pop，树枝会逐级退回，看起来更像穿越的感觉。<br>Tips: 在pop清空之前，随时可以通过restore恢复其中一个快照，同样快照不会删除；不影响pop的测试。</p>
<p>2.8 远程连接分享<br>远程连接通过share connect两个命令可以实现通过本机vagrant连接另外一台host上的虚机。<br>2.8.1 允许ssh连接<br>$ vagrant share –ssh<br>==&gt; default: Detecting network information for machine…<br>    default: Local machine address: 127.0.0.1<br>    default:<br>    default: Note: With the local address (127.0.0.1), Vagrant Share can only<br>    default: share any ports you have forwarded. Assign an IP or address to your<br>    default: machine to expose all TCP ports. Consult the documentation<br>    default: for your provider (‘virtualbox’) for more information.<br>    default:<br>    default: An HTTP port couldn’t be detected! Since SSH is enabled, this is<br>    default: not an error. If you want to share both SSH and HTTP, please set<br>    default: an HTTP port with <code>--http</code>.<br>    default:<br>    default: Local HTTP port: disabled<br>    default: Local HTTPS port: disabled<br>    default: SSH Port: 2200<br>    default: Port: 2200<br>==&gt; default: Generating new SSH key…<br>    default: Please enter a password to encrypt the key: [输入授权密码]<br>    default: Repeat the password to confirm:[再输一次]<br>    default: Inserting generated SSH key into machine…<br>==&gt; default: Checking authentication and authorization…<br>==&gt; default: Creating Vagrant Share session…<br>    default: Share will be at: vile-ibex-8238<br>==&gt; default: Your Vagrant Share is running! Name: vile-ibex-8238<br>==&gt; default:<br>==&gt; default: You’re sharing your Vagrant machine in “restricted” mode. This<br>==&gt; default: means that only the ports listed above will be accessible by<br>==&gt; default: other users (either via the web URL or using <code>vagrant connect</code>).<br>==&gt; default:<br>==&gt; default: You’re sharing with SSH access. This means that another user<br>==&gt; default: simply has to run <code>vagrant connect --ssh vile-ibex-8238</code><br>==&gt; default: to SSH to your Vagrant machine.<br>==&gt; default:<br>==&gt; default: Because you encrypted your SSH private key with a password,<br>==&gt; default: the other user will be prompted for this password when they<br>==&gt; default: run <code>vagrant connect --ssh</code>. Please share this password with them<br>==&gt; default: in some secure way.</p>
<p>Tips: 你可以通过–name指定一个名称，否则会随机生成一个共享名，如本例中的vile-ibex-8238</p>
<p>2.8.2 连接远端ssh虚机<br>$ vagrant connect –ssh vile-ibex-8238 –static-ip 10.2.136.211<br>Loading share ‘vile-ibex-8238’…<br>The SSH key to connect to this share is encrypted. You will require<br>the password entered when creating to share to decrypt it. Verify you<br>access to this password before continuing.</p>
<p>Press enter to continue, or Ctrl-C to exit now.[回车]<br>Password for the private key:[输入授权密码]<br>Executing SSH…<br>vagrant@vagrant-ubuntu-trusty-64:~$</p>
<p>2.8.3 共享http<br>vagrant share可以把host主机的http开放到远端，供任何人访问，这好像跟vm没什么关系，但的确它发生了。<br>$ ~/apache-tomcat-8.0.28/bin/startup.sh<br>$ vagrant share –http 80<br>==&gt; default: Detecting network information for machine…<br>    default: Local machine address: 127.0.0.1<br>    default:<br>    default: Note: With the local address (127.0.0.1), Vagrant Share can only<br>    default: share any ports you have forwarded. Assign an IP or address to your<br>    default: machine to expose all TCP ports. Consult the documentation<br>    default: for your provider (‘virtualbox’) for more information.<br>    default:<br>    default: Local HTTP port: 80<br>    default: Local HTTPS port: disabled<br>    default: Port: 2200<br>==&gt; default: Checking authentication and authorization…<br>==&gt; default: Creating Vagrant Share session…<br>    default: Share will be at: enchanting-buffalo-1493<br>==&gt; default: Your Vagrant Share is running! Name: enchanting-buffalo-1493<br>==&gt; default: URL: <a href="http://enchanting-buffalo-1493.vagrantshare.com" target="_blank" rel="noopener">http://enchanting-buffalo-1493.vagrantshare.com</a><br>==&gt; default:<br>==&gt; default: You’re sharing your Vagrant machine in “restricted” mode. This<br>==&gt; default: means that only the ports listed above will be accessible by<br>==&gt; default: other users (either via the web URL or using <code>vagrant connect</code>).</p>
<p>我的host电脑在内网，在外网的任意一台电脑上，访问<a href="http://enchanting-buffalo-1493.vagrantshare.com，奇迹发生了。" target="_blank" rel="noopener">http://enchanting-buffalo-1493.vagrantshare.com，奇迹发生了。</a></p>
<p>话说这个有什么用呢？别忘记，vagrant有一个端口映射的功能，在后面的Vagrantfile配置里会提到，这样做的结果，就是可以在互联网任意一个角落可以访问到你的虚机的http服务。</p>
<p>2.9 windows相关的操作<br>powershelgl和rdp是windows vm相关的操作，未做测试，忽略。</p>
<p>2.10 虚机环境部署<br>provision用于通过Vagrantfile配置文件，对vm进行部署，如安装软件，发布应用等，在这里不多说，专门一章来记录。</p>
<p>2.11 指定vmid操作虚拟机<br>在3.3.2中，我们可以看到当前工作机中的所有虚机，其中第一列数据为vmid，我们可以无需进入vagrant工作目录，操作这些虚机。如：<br>$ vagrant up 63093ce</p>
<p>该方式适用于前面提到的up、reload、halt、destroy等命令。</p>
<p>3 监控虚拟机<br>3.1 查看sshd配置信息<br>$ vagrant ssh-config<br>Host default<br>  HostName 127.0.0.1<br>  User vagrant<br>  Port 2222<br>  UserKnownHostsFile /dev/null<br>  StrictHostKeyChecking no<br>  PasswordAuthentication no<br>  IdentityFile “/Users/pollyduan/vm/ubuntu/.vagrant/machines/default/virtualbox/private_key”<br>  IdentitiesOnly yes<br>  LogLevel FATAL</p>
<p>3.2 查看虚拟机开放的端口<br>$ vagrant port<br>The forwarded ports for the machine are listed below. Please note that<br>these values may differ from values configured in the Vagrantfile if the<br>provider supports automatic port collision detection and resolution.</p>
<pre><code>22 (guest) =&gt; 2222 (host)</code></pre><p>3.3 查看虚拟机状态<br>3.3.1 查看当前vm状态<br>$ cd ~/vm/ubuntu<br>$ vagrant status<br>Current machine states:</p>
<p>default                   poweroff (virtualbox)</p>
<p>The VM is powered off. To restart the VM, simply run <code>vagrant up</code></p>
<p>状态可能是：<br>not create | 执行vagrant init命令后，从未启动过<br>poweroff | 关机<br>running | 运行中<br>saved | 休眠</p>
<p>3.3.2 查看全部虚机状态<br>此命令无需进入vagrant工作目录。<br>$ vagrant global-status</p>
<h2 id="id-name-provider-state-directory"><a href="#id-name-provider-state-directory" class="headerlink" title="id       name       provider   state    directory"></a>id       name       provider   state    directory</h2><p>be5dee2  mfsmaster  virtualbox poweroff /Users/pollyduan/vm/mfs<br>a523de6  mfschunk1  virtualbox poweroff /Users/pollyduan/vm/mfs<br>8377e0d  mfschunk2  virtualbox poweroff /Users/pollyduan/vm/mfs<br>b772b1f  metalogger virtualbox poweroff /Users/pollyduan/vm/mfs<br>8a5f10e  mfsclient  virtualbox poweroff /Users/pollyduan/vm/mfs<br>63093ce  default    virtualbox poweroff /Users/pollyduan/vm/ubuntu</p>
<p>你可能会发现，为什么有的是default，有的是有名字的。这就是因为mfsxxxx是在vagrantfile中指定了vb.name，他对应的virtualbox工作目录也是这个值，而ubuntu这个虚机没有指定，所以是default，而且其virtualbox工作目录也是比较长的——ubuntu_default_1453944793418_7699。</p>
<p>global-status统计信息不是实时的，所有不能保证数据是绝对准确的。如果在vagrant up启动后，我们在virtualbox管理终端关闭vm，global-status是捕获不到的，它还是会显示running状态。<br>截至1.8.1还是这样的，应该算是一个bug。处女座可能无法接受这个现实，那么你可以进入vagrant工作目录，手动再指定一次vagrant halt，状态就同步了。</p>
<p>4 其他命令<br>4.1 help<br>略。</p>
<p>4.2 login<br>登录到中央仓库</p>
<p>4.3 plugin<br>插件管理，略。</p>
<p>4.4 push<br>发布镜像到中央仓库</p>
<p>4.5 version<br>略。</p>

    </div>

    
    
    

    <footer class="post-footer">
          
        
        <div class="post-tags">
            <a href="/tags/vagrant/" rel="tag"># vagrant</a>
          
        </div>
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
              <a href="/mo-ren-fen-lei/generate-pdf-documents-from-html-pages-using-php.html" rel="next" title="利用PHP将HTML页面生成PDF文档">
                <i class="fa fa-chevron-left"></i> 利用PHP将HTML页面生成PDF文档
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
              <a href="/note/local-network-remote-access-frp-intranet-penetration.html" rel="prev" title="本地网络 远程访问 frp内网穿透">
                本地网络 远程访问 frp内网穿透 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
    </footer>
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  


        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Murry</p>
  <div class="site-description motion-element" itemprop="description">分享哟,php程序猿,php博客,phpblog</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/qiaoanqiao" title="GitHub &rarr; https://github.com/qiaoanqiao" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="/fenxiangy@163.com" title="E-Mail &rarr; fenxiangy@163.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-number">1.</span> <span class="nav-text"></span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#id-name-provider-state-directory"><span class="nav-number">1.1.</span> <span class="nav-text">id       name       provider   state    directory</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Murry</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.3.0</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>
  <script src="/lib/unpkg.com/valine/dist/Valine.min.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/schemes/muse.js?v=7.3.0"></script>



<script src="/js/next-boot.js?v=7.3.0"></script>






  















  <script src="/js/local-search.js?v=7.3.0"></script>














  

  

  


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>


    <script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: '5MAshWrT8VHdC9f9YLj5g6xG-MdYXbMMI',
    appKey: 'n8k126UjSFx0MaQvxcMuyoa0',
    placeholder: 'ヾﾉ≧∀≦)o 来呀！快活呀！~',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-Hans' || 'zh-cn',
    path: location.pathname
  });
</script>

</body>
</html>
